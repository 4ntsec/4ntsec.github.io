{{/* ------------------------------------------------------------
   Head Meta Partial - Simplified (No .Scratch Nil Panic)
   ------------------------------------------------------------ */}}

{{/* --- Title and Description --- */}}
{{ $title := .Site.Title }}
{{ $description := .Site.Params.description | default "" }}
{{ $publisherIcon := .Site.Params.favicon }}

{{ if eq .Kind "home" }}
  {{ $title = .Site.Params.brand | default $title }}
  {{ $description = .Site.Params.description | default $description }}
{{ else if .IsSection }}
  {{ $title = printf "%s - %s" (.Site.Params.brand | default $title) .LinkTitle }}
  {{ $description = .Description | default $description }}
{{ else if .IsPage }}
  {{ $title = printf "%s - %s" (.Site.Params.brand | default $title) .LinkTitle }}
  {{ $description = .Description | default $description }}
{{ end }}

<!-- Title Tags -->
<title itemprop="name">{{ $title }}</title>
<meta property="og:title" content="{{ $title }}" />
<meta name="twitter:title" content="{{ $title }}" />
<meta itemprop="name" content="{{ $title }}" />
<meta name="application-name" content="{{ $title }}" />
<meta property="og:site_name" content="{{ .Site.Title }}" />

<!-- Description Tags -->
<meta name="description" content="{{ $description }}" />
<meta itemprop="description" content="{{ $description }}" />
<meta property="og:description" content="{{ $description }}" />
<meta name="twitter:description" content="{{ $description }}" />

<!-- Open Graph image and Twitter Card metadata -->
{{ $image_path := .Params.image | default .Site.Params.og_image }}
{{ with $image_path }}
  {{ $image_path_local := printf "assets/%s" . }}
  {{ $image_ext := trim (path.Ext . | lower) "." }}
  {{ if fileExists $image_path_local }}
    {{ $image_res := resources.Get . }}
    <meta property="og:image" content="{{ $image_res.RelPermalink }}" />
    {{ if ne $image_ext "svg" }}
      {{ with (imageConfig $image_path_local) }}
        {{ if and (gt .Width 144) (gt .Height 144) }}
          <meta name="twitter:image" content="{{ $image_res.RelPermalink }}"/>
          <meta name="twitter:card" content="summary{{ if and (gt .Width 300) (gt .Height 157) (ne .Width .Height) }}_large_image{{ end }}">
        {{ end }}
        <meta property="og:image:width" content="{{ .Width }}">
        <meta property="og:image:height" content="{{ .Height }}">
      {{ end }}
    {{ end }}
    <meta property="og:image:type" content="image/{{ if eq $image_ext "svg" }}svg+xml{{ else }}{{ replaceRE `^jpg$` `jpeg` $image_ext }}{{ end }}">
  {{ end }}
{{ end }}

<!-- Link Tags -->
<base href="{{ .Permalink }}" />
<link rel="canonical" href="{{ .Permalink }}" itemprop="url" />
<meta name="url" content="{{ .Permalink }}" />
<meta name="twitter:url" content="{{ .Permalink }}" />
<meta property="og:url" content="{{ .Permalink }}" />

<!-- Date Tags -->
<meta property="og:updated_time" content="{{ .Lastmod.Format "2006-01-02T15:04:05Z07:00" }}" />

<!-- Sitemap & Alternate Outputs -->
<link rel="sitemap" type="application/xml" title="Sitemap" href='{{ "sitemap.xml" | absURL }}' />
{{ range .AlternativeOutputFormats }}
  <link href="{{ .Permalink }}" rel="{{ .Rel }}" type="{{ .MediaType.Type }}" title="{{ $.Site.Title }}" />
{{ end }}

<!-- Search Engine Crawler Tags -->
<meta name="robots" content="index,follow" />
<meta name="googlebot" content="index,follow" />

<!-- Social Media Tags -->
{{ if or (.Site.Params.twitter_url) (.Site.Params.x_url) }}
  {{ $twitter_user := index (split (default .Site.Params.twitter_url .Site.Params.x_url) "/") 3 }}
  <meta name="twitter:site" content="@{{ $twitter_user }}" />
  <meta name="twitter:creator" content="@{{ $twitter_user }}" />
{{ end }}
<meta property="fb:admins" content="{{ .Site.Params.fb.admins }}" />

<!-- Other Tags -->
<meta name="apple-mobile-web-app-title" content="{{ .Site.Title }}" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black" />

<!-- Article Specific Tags -->
{{ if eq .Section "posts" }}
  {{ if .IsNode }}
    {{ $paginator := .Paginate (where .Pages "Type" "posts") }}
    {{ if $paginator }}
      <link rel="first" href="{{ $paginator.First.URL }}" />
      <link rel="last" href="{{ $paginator.Last.URL }}" />
      {{ if $paginator.HasPrev }}
        <link rel="prev" href="{{ $paginator.Prev.URL }}" />
      {{ end }}
      {{ if $paginator.HasNext }}
        <link rel="next" href="{{ $paginator.Next.URL }}" />
      {{ end }}
    {{ end }}
  {{ end }}

  <meta property="og:type" content="article" />
  <meta property="article:publisher" content="{{ .Site.Params.facebook_url }}" />
  <meta property="og:article:published_time" content="{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}" />
  <meta property="article:published_time" content="{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}" />

  {{ with (or .Params.Author .Site.Language.Params.Author.Name) }}
    <meta property="og:article:author" content="{{ . }}" />
    <meta property="article:author" content="{{ . }}" />
    <meta name="author" content="{{ . }}" />
  {{ end }}

  {{ with .Params.category }}
    <meta name="news_keywords" content="{{ index . 0 }}" />
    <meta property="article:section" content="{{ index . 0 }}" />
  {{ end }}
{{ end }}

<!-- Hugo Generator Attribution -->
{{ hugo.Generator }}
